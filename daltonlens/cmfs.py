import math
import numpy as np
import colour # from pip install colour-science

from colour import MSDS_CMFS

# CIE 1931 2-deg, XYZ CMFs modified by Judd (1951) and Vos (1978)
# From http://www.cvrl.org/
XYZ_JuddVos_DATA_CMF = {
    380: (0.0026899, 0.0002, 0.01226),
    385: (0.0053105, 0.00039556, 0.024222),
    390: (0.010781, 0.0008, 0.04925),
    395: (0.020792, 0.0015457, 0.095135),
    400: (0.037981, 0.0028, 0.17409),
    405: (0.063157, 0.0046562, 0.29013),
    410: (0.099941, 0.0074, 0.46053),
    415: (0.15824, 0.011779, 0.73166),
    420: (0.22948, 0.0175, 1.0658),
    425: (0.28108, 0.022678, 1.3146),
    430: (0.31095, 0.0273, 1.4672),
    435: (0.33072, 0.032584, 1.5796),
    440: (0.33336, 0.0379, 1.6166),
    445: (0.31672, 0.042391, 1.5682),
    450: (0.28882, 0.0468, 1.4717),
    455: (0.25969, 0.052122, 1.374),
    460: (0.23276, 0.06, 1.2917),
    465: (0.20999, 0.072942, 1.2356),
    470: (0.17476, 0.09098, 1.1138),
    475: (0.13287, 0.11284, 0.9422),
    480: (0.091944, 0.13902, 0.75596),
    485: (0.056985, 0.16987, 0.5864),
    490: (0.031731, 0.20802, 0.44669),
    495: (0.014613, 0.25808, 0.34116),
    500: (0.0048491, 0.323, 0.26437),
    505: (0.0023215, 0.4054, 0.20594),
    510: (0.0092899, 0.503, 0.15445),
    515: (0.029278, 0.60811, 0.10918),
    520: (0.063791, 0.71, 0.076585),
    525: (0.11081, 0.7951, 0.056227),
    530: (0.16692, 0.862, 0.041366),
    535: (0.22768, 0.91505, 0.029353),
    540: (0.29269, 0.954, 0.020042),
    545: (0.36225, 0.98004, 0.013312),
    550: (0.43635, 0.99495, 0.0087823),
    555: (0.51513, 1.0001, 0.0058573),
    560: (0.59748, 0.995, 0.0040493),
    565: (0.68121, 0.97875, 0.0029217),
    570: (0.76425, 0.952, 0.0022771),
    575: (0.84394, 0.91558, 0.0019706),
    580: (0.91635, 0.87, 0.0018066),
    585: (0.97703, 0.81623, 0.0015449),
    590: (1.023, 0.757, 0.0012348),
    595: (1.0513, 0.69483, 0.0011177),
    600: (1.055, 0.631, 0.00090564),
    605: (1.0362, 0.56654, 0.00069467),
    610: (0.99239, 0.503, 0.00042885),
    615: (0.92861, 0.44172, 0.00031817),
    620: (0.84346, 0.381, 0.00025598),
    625: (0.73983, 0.32052, 0.00015679),
    630: (0.63289, 0.265, 9.7694E-05),
    635: (0.53351, 0.21702, 6.8944E-05),
    640: (0.44062, 0.175, 5.1165E-05),
    645: (0.35453, 0.13812, 3.6016E-05),
    650: (0.27862, 0.107, 2.4238E-05),
    655: (0.21485, 0.081652, 1.6915E-05),
    660: (0.16161, 0.061, 1.1906E-05),
    665: (0.1182, 0.044327, 8.1489E-06),
    670: (0.085753, 0.032, 5.6006E-06),
    675: (0.063077, 0.023454, 3.9544E-06),
    680: (0.045834, 0.017, 2.7912E-06),
    685: (0.032057, 0.011872, 1.9176E-06),
    690: (0.022187, 0.00821, 1.3135E-06),
    695: (0.015612, 0.0057723, 9.1519E-07),
    700: (0.011098, 0.004102, 6.4767E-07),
    705: (0.0079233, 0.0029291, 4.6352E-07),
    710: (0.0056531, 0.002091, 3.3304E-07),
    715: (0.0040039, 0.0014822, 2.3823E-07),
    720: (0.0028253, 0.001047, 1.7026E-07),
    725: (0.0019947, 0.00074015, 1.2207E-07),
    730: (0.0013994, 0.00052, 8.7107E-08),
    735: (0.0009698, 0.00036093, 6.1455E-08),
    740: (0.00066847, 0.0002492, 4.3162E-08),
    745: (0.00046141, 0.00017231, 3.0379E-08),
    750: (0.00032073, 0.00012, 2.1554E-08),
    755: (0.00022573, 8.462E-05, 1.5493E-08),
    760: (0.00015973, 6E-05, 1.1204E-08),
    765: (0.00011275, 4.2446E-05, 8.0873E-09),
    770: (7.9513E-05, 3E-05, 5.834E-09),
    775: (5.6087E-05, 2.121E-05, 4.211E-09),
    780: (3.9541E-05, 1.4989E-05, 3.0383E-09),
    785: (2.7852E-05, 1.0584E-05, 2.1907E-09),
    790: (1.9597E-05, 7.4656E-06, 1.5778E-09),
    795: (1.377E-05, 5.2592E-06, 1.1348E-09),
    800: (9.67E-06, 3.7028E-06, 8.1565E-10),
    805: (6.7918E-06, 2.6076E-06, 5.8626E-10),
    810: (4.7706E-06, 1.8365E-06, 4.2138E-10),
    815: (3.355E-06, 1.295E-06, 3.0319E-10),
    820: (2.3534E-06, 9.1092E-07, 2.1753E-10),
    825: (1.6377E-06, 6.3564E-07, 1.5476E-10)
}

def wavelength_to_XYZ(wavelength):
    cmfs = MSDS_CMFS['CIE 1931 2 Degree Standard Observer']
    return colour.wavelength_to_XYZ(wavelength, cmfs)

def wavelength_to_XYZ_JuddVos(wavelength):
    XYZ_JuddVos_cmfs = colour.colorimetry.XYZ_ColourMatchingFunctions(
        XYZ_JuddVos_DATA_CMF,
        name='CIE 1931 2-deg, XYZ CMFs modified by Judd (1951) and Vos (1978)',
        strict_name='CIE 1931 2-deg, XYZ CMFs modified by Judd (1951) and Vos (1978)'
    )
    return colour.wavelength_to_XYZ(wavelength, XYZ_JuddVos_cmfs)
